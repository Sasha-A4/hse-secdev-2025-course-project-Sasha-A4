---
Status: Accepted
Date: 2025-10-20
---

## Context
Входные данные валидировались неоднородно:
- Отсутствие проверки длины строк (`title`, `description`)
- Нет валидации значений голосов (`vote` может быть любым числом)
- Отсутствие ограничений на query параметры (`limit` без границ)
- Нестандартные сообщения об ошибках

Это создаёт риски:
- Buffer overflow через длинные строки
- Логические ошибки в голосовании
- DoS через большие `limit` значения
- Плохой UX из-за неясных ошибок

## Decision
Внедрить централизованную валидацию с чёткими правилами:
- **Строки**: `title` 1-100 символов, `description` не пустая
- **Голоса**: `vote.value` только -1 или +1
- **Query**: `limit` в диапазоне 1-100
- **Ошибки**: RFC 7807 с понятными сообщениями
- **Pydantic**: использовать встроенную валидацию моделей

## Alternatives
1. **Валидация только на уровне Pydantic** - отклонено: не покрывает query параметры
2. **Валидация в каждом эндпоинте отдельно** - отклонено: дублирование кода
3. **Без валидации** - отклонено: не решает риски безопасности
4. **Валидация только на клиенте** - отклонено: небезопасно

## Consequences
**Положительные:**
- Предсказуемое поведение API
- Защита от buffer overflow и DoS
- Улучшенный UX с понятными ошибками
- Соответствие NFR-02 и NFR-09

**Отрицательные:**
- Дополнительные проверки на каждый запрос
- Требуется обновление тестов
- Более строгие ограничения для клиентов

## Security Impact
- **Предотвращение buffer overflow**: ограничение длины строк
- **Защита от DoS**: ограничение размера query параметров
- **Валидация бизнес-логики**: корректные значения голосов
- **Information disclosure**: стандартизированные сообщения об ошибках

## Rollout Plan
1. **Фаза 1**: Обновление Pydantic моделей с валидацией
2. **Фаза 2**: Добавление валидации query параметров
3. **Фаза 3**: Интеграция с RFC 7807 error responses
4. **Фаза 4**: Обновление тестов и документации

## Links
- NFR: NFR-02 (Data validation), NFR-09 (Error hygiene)
- Threat Model: STRIDE Tampering/Input
- Code: `app/main.py`, `app/models.py`
- Tests: `tests/test_features.py` (негативные кейсы)
